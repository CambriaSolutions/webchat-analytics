steps:
  # NPM Install
  - name: 'gcr.io/cloud-builders/npm'
    args: ['install']
  # NPM Install Functions
  - name: 'gcr.io/cloud-builders/npm'
    args: ['run', 'postinstall']
  # Test
  - name: 'gcr.io/cloud-builders/npm'
    args: ['run', 'test']
  # Build
  - name: 'gcr.io/cloud-builders/npm'
    args: ['run', 'build']
  # Deploy
  - name: 'gcr.io/$PROJECT_ID/firebase'
    args:
      [
        'deploy',
        '-P',
        'webchat-analytics',
        '--only',
        'functions,hosting',
        '--token',
        '$_FIREBASE_DEPLOY_TOKEN',
      ]
